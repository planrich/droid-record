

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setup &mdash; Droid Record 0.1.4 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Droid Record 0.1.4 documentation" href="../index.html"/>
        <link rel="prev" title="Getting Started" href="gradle.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> Droid Record</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gradle.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gradle.html#changelog">Changelog</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#commands">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-first-table">Creating the first table</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-and-migrate-the-database">Create and migrate the Database</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Droid Record</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Setup</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/general/setup.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p>Droid Record (DR) is tightly integrated into the new Android tool chain.
The next code block shows how to integrate DR into the gradle build system.</p>
<div class="highlight-groovy"><div class="highlight"><pre><span class="n">buildscript</span> <span class="o">{</span>
    <span class="n">repositories</span> <span class="o">{</span>
       <span class="n">mavenCentral</span><span class="o">()</span>
       <span class="n">jcenter</span><span class="o">()</span> <span class="c1">// DR is located here</span>
    <span class="o">}</span>
    <span class="n">dependencies</span> <span class="o">{</span>
       <span class="n">classpath</span> <span class="s1">&#39;at.pasra.record:generator:0.1.4&#39;</span> <span class="c1">// loads the plugin</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
    <span class="n">jcenter</span><span class="o">()</span> <span class="c1">// DR is located here</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s1">&#39;at.pasra.record:library:0.1.4@aar&#39;</span> <span class="c1">// loads the droid record library</span>
<span class="o">}</span>

<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;droid_record&#39;</span> <span class="c1">// activates the plugin</span>

<span class="n">droid_record</span> <span class="o">{</span> <span class="c1">// custom configuration for this project</span>
    <span class="n">domain_package</span><span class="o">=</span><span class="s1">&#39;com.example.sample.domain&#39;</span>
    <span class="n">output_package</span><span class="o">=</span><span class="s1">&#39;com.example.sample.generate&#39;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>By applying the plugin &#8216;droid_record&#8217; two tasks gradle tasks are added to
your project. Additionally every time you compile your project the migration
will be automatically generated.</p>
<p>Droid Record has it&#8217;s own configuration block where you
can specify the following parameters:</p>
<ul class="simple">
<li><strong>output_package</strong>: (required) The package of the generated classes. Example: &#8216;com.example.generate&#8217;</li>
<li><strong>domain_package</strong>: (required) The package for the Java classes you might want to extend with our code! Example: &#8216;com.example.domain&#8217;</li>
<li><strong>migration_path</strong>: A path relative to the build.gradle file. In this folder the migration files and the relationship file will be searched. Default: &#8216;src/main/record&#8217;</li>
<li><strong>relationship</strong>: The filename of the relationship file, default: &#8216;relationship.dr&#8217;</li>
<li><strong>output_path</strong>: A path relative to the build.gradle file. The code will be generated to the package in this folder. Default: &#8216;src/main/java&#8217;</li>
</ul>
<div class="section" id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell"><div class="highlight"><pre><span class="nv">$ </span>gradle migration -Dname<span class="o">=</span>something_your_remember
</pre></div>
</div>
<p>Generates a file in the migration_path of the following format: {revision}_{name}.dr.
You can also add this file by hand and use any number instead of the timestamp.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you add the files by hand you should ensure that the files have increasing timestamps.
If the migration numbering is not given, Droid Record cannot ensure that the generated code is correct
and in most cases will refuse to generate code.</p>
</div>
<div class="highlight-shell"><div class="highlight"><pre><span class="nv">$ </span>gradle migrate
</pre></div>
</div>
<p>Loads the relationship and all migration files. Sanitizes the input and if the given input is correct
produces the code.
Additionally this command is idempotent. You can invoke it as many times as you like and it will generate
the same output as long as the input stays the same.</p>
</div>
<div class="section" id="creating-the-first-table">
<h2>Creating the first table<a class="headerlink" href="#creating-the-first-table" title="Permalink to this headline">¶</a></h2>
<p>DR uses groovy files (ending dr) to describe you database objects.
To create your first table you can do the following:</p>
<div class="highlight-groovy"><div class="highlight"><pre><span class="n">create_table</span> <span class="o">{</span>
  <span class="n">name</span> <span class="s1">&#39;picture&#39;</span>
  <span class="n">fields</span> <span class="o">{</span>
    <span class="n">image</span> <span class="s1">&#39;blob&#39;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Droid Record generates the following directory structure:</p>
<div class="highlight-shell"><div class="highlight"><pre>com/example/sample/generate
  ├── AbstractPicture.java
  ├── Picture.java
  ├── PictureRecord.java
  ├── PictureRecordBuilder.java
  ├── LocalSession.java
  └── RecordMigrator.java
</pre></div>
</div>
</div>
<div class="section" id="create-and-migrate-the-database">
<h2>Create and migrate the Database<a class="headerlink" href="#create-and-migrate-the-database" title="Permalink to this headline">¶</a></h2>
<p>One possibility and in most cases the most suitable for many applications is
to create a Application subclass.</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomApp</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">LocalSession</span> <span class="n">session</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
       <span class="n">db</span> <span class="o">=</span> <span class="n">openOrCreateDatabase</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="n">MODE_PRIVATE</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
       <span class="k">new</span> <span class="n">RecordMigrator</span><span class="o">(</span><span class="n">db</span><span class="o">).</span><span class="na">migrate</span><span class="o">();</span>
       <span class="n">session</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalSession</span><span class="o">(</span><span class="n">db</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">LocalSession</span> <span class="nf">getSession</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">session</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>When your application starts the database will be setup and migrated once. After that you are able
to populate your database and query it. The following example shows how you can use the generated
classes:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">LocalSession</span> <span class="n">session</span> <span class="o">=</span> <span class="o">((</span><span class="n">CustomApp</span><span class="o">)</span><span class="n">getApplication</span><span class="o">()).</span><span class="na">getSession</span><span class="o">();</span>

<span class="n">Picture</span> <span class="n">picture</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Picture</span><span class="o">();</span>
<span class="n">picture</span><span class="o">.</span><span class="na">setImage</span><span class="o">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[]</span> <span class="o">{</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span><span class="mh">0xca</span><span class="o">,</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span><span class="mh">0xfe</span><span class="o">,</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span><span class="mh">0xba</span><span class="o">,</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span><span class="mh">0xbe</span> <span class="o">});</span>
<span class="n">session</span><span class="o">.</span><span class="na">savePicture</span><span class="o">(</span><span class="n">picture</span><span class="o">);</span> <span class="c1">// save is insert or update at the same time.</span>
<span class="n">session</span><span class="o">.</span><span class="na">savePicture</span><span class="o">(</span><span class="n">picture</span><span class="o">);</span> <span class="c1">// this second call will invoke update</span>
<span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">picture</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
<span class="n">Picture</span> <span class="n">picCopy</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">findPicture</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">destroyPicture</span><span class="o">(</span><span class="n">picCopy</span><span class="o">);</span>
<span class="n">picture</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="gradle.html" class="btn btn-neutral" title="Getting Started"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Richard Plangger.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>